<%- include('../partials/header', { title: 'Listado de Préstamos Especiales' }) %>

<div class="container-fluid py-4 px-4">
    <div class="card shadow-lg border-0 rounded-3 mb-4">
        <div class="card-header bg-gradient-primary text-white py-4">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="mb-0 text-center flex-grow-1">
                    <i class="fas fa-list-alt me-3 fa-lg"></i>Gestión de Préstamos Especiales
                </h2>
                <div>
                    <a href="/prestamos-especiales/nuevo" class="btn btn-light btn-lg text-primary fw-bold shadow-sm" title="Crear Nuevo Préstamo">
                        <i class="fas fa-plus-circle me-2"></i>Nuevo Préstamo
                    </a>
                </div>
            </div>
        </div>

        <div class="card-body p-4">
            <% if (typeof messages !== 'undefined' && messages.success) { %>
                <div class="alert alert-success alert-dismissible fade show border-0 rounded-pill text-center" role="alert">
                    <i class="fas fa-check-circle me-2"></i><%= messages.success %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            <% } %>
            <% if (typeof messages !== 'undefined' && messages.error) { %>
                <div class="alert alert-danger alert-dismissible fade show border-0 rounded-pill text-center" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i><%= messages.error %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            <% } %>
            <% if (typeof messages !== 'undefined' && messages.info) { %>
                <div class="alert alert-info alert-dismissible fade show border-0 rounded-pill text-center" role="alert">
                    <i class="fas fa-info-circle me-2"></i><%= messages.info %>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            <% } %>

            <% if (prestamos && prestamos.length > 0) { %>
                <div class="table-responsive">
                    <table class="table table-hover table-striped table-bordered align-middle mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Cliente</th>
                                 <th scope="col">Cédula</th>
                                <!--<th scope="col">Ruta/Zona</th> -->
                                <th scope="col">Monto Solicitado</th>
                                <th scope="col">Monto Aprobado</th>
                                <th scope="col">Capital Restante</th>
                                <th scope="col">Estado</th>
                                <th scope="col">Fecha Creación</th>
                                <th scope="col" class="text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% prestamos.forEach(prestamo => { %>
                                <tr>
                                    <td><span class="badge bg-secondary fw-normal"><%= prestamo.id %></span></td>
                                    <td><%= prestamo.cliente_nombre %> <%= prestamo.cliente_apellidos %></td>
                                     <td><%= prestamo.cliente_cedula %></td>
                                    <!--<td><%= prestamo.ruta_nombre && prestamo.ruta_zona ? `${prestamo.ruta_zona} - ${prestamo.ruta_nombre}` : 'N/A' %></td> -->
                                    <td>RD$ <%= parseFloat(prestamo.monto_solicitado || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                    <td>RD$ <%= parseFloat(prestamo.monto_aprobado || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                    <td>RD$ <%= parseFloat(prestamo.capital_restante || 0).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }) %></td>
                                    <td>
                                        <%
                                            let estadoBadgeClass = '';
                                            switch (prestamo.estado) {
                                                case 'pendiente': estadoBadgeClass = 'bg-warning text-dark'; break;
                                                case 'aprobado': estadoBadgeClass = 'bg-success'; break;
                                                case 'rechazado': estadoBadgeClass = 'bg-danger'; break;
                                                case 'pagado': estadoBadgeClass = 'bg-primary'; break;
                                                default: estadoBadgeClass = 'bg-secondary';
                                            }
                                        %>
                                        <span class="badge <%= estadoBadgeClass %>"><%= prestamo.estado.charAt(0).toUpperCase() + prestamo.estado.slice(1) %></span>
                                    </td>
                                    <td><%= prestamo.fecha_creacion_formatted %></td>
                                    <td class="text-center">
                                        <a href="/prestamos-especiales/<%= prestamo.id %>" class="btn btn-sm btn-outline-info me-1" title="Ver Detalles">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="/prestamos-especiales/<%= prestamo.id %>/editar" class="btn btn-sm btn-outline-warning" title="Editar Préstamo">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                            <% }); %>
                        </tbody>
                    </table>
                </div>
            <% } else { %>
                <div class="alert alert-info text-center m-4 py-3 rounded-3 border-0">
                    <i class="fas fa-info-circle me-2"></i> No se han encontrado préstamos especiales registrados.
                </div>
            <% } %>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>

<style>
    /* Estilos adicionales para un toque profesional */
    .bg-gradient-primary {
        background: linear-gradient(45deg, #007bff, #0056b3); /* Primary blue gradient */
    }
    .bg-gradient-success {
        background: linear-gradient(45deg, #28a745, #1e7e34); /* Green gradient */
    }
    .bg-gradient-info {
        background: linear-gradient(45deg, #17a2b8, #117a8b); /* Info blue gradient */
    }
    .card-header h2, .card-header h3, .card-header h4 {
        font-weight: 600; /* Slightly bolder headers */
    }
    .table-hover tbody tr:hover {
        background-color: #e9ecef; /* Lighter hover background */
    }
    .badge {
        font-size: 0.8em; /* Slightly smaller badges for detail */
        padding: 0.4em 0.7em;
        font-weight: 600;
    }
    dl.row dt {
        font-weight: 500;
    }
    dl.row dd {
        margin-bottom: 0.5rem;
    }
</style>