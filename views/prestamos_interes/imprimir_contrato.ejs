<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrato de Préstamo - Financiera Caribe Azul</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      margin: 0;
      padding: 0;
      color: #333;
      background-color: #fff;
      font-size: 11px;
      line-height: 1.4;
    }

    .contract-container {
      width: 100%;
      max-width: 7.5in;
      margin: 0 auto;
      padding: 0.4in;
    }

    .title {
      font-family: 'Merriweather', serif;
      text-align: center;
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 12px;
      border-bottom: 1px solid #0f4c75;
      padding-bottom: 5px;
      color: #0f4c75;
    }

    .section {
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px dashed #ccc;
    }

    .section:last-of-type {
      border-bottom: none;
    }

    .section-heading {
      font-size: 12px;
      font-weight: 600;
      color: #0f4c75;
      margin-bottom: 5px;
      border-left: 3px solid #3282b8;
      padding-left: 6px;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 10px;
    }

    .data-table th,
    .data-table td {
      border: 1px solid #ccc;
      padding: 4px 6px;
      text-align: left;
      vertical-align: top;
    }

    .data-table thead th {
      background-color: #f0f8ff;
      font-weight: 700;
    }

    .commitment-text {
      background-color: #f2f7fc;
      border-left: 3px solid #3282b8;
      padding: 10px;
      font-size: 10px;
      border-radius: 3px;
      color: #444;
    }

    .commitment-text strong {
      color: #0f4c75;
    }

    .signature-section {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .signature-block {
      width: 45%;
      text-align: center;
      margin-top: 10px;
    }

    .signature-line {
      border-top: 1px solid #000;
      margin: 8px auto 4px auto;
      width: 80%;
    }

    .signature-label {
      font-size: 9px;
      color: #444;
    }

    @media print {
      @page {
        size: letter;
        margin: 0.4in;
      }

      body {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .contract-container {
        padding: 0.3in;
      }

      .title {
        font-size: 16px;
        color: #000;
        border-color: #000;
      }

      .section-heading {
        color: #000;
        border-left-color: #000;
      }

      .data-table thead th {
        background-color: #e0e0e0 !important;
        color: #000 !important;
      }

      .data-table td {
        color: #000;
      }

      .commitment-text {
        background-color: #f0f0f0 !important;
        color: #000;
        border-left-color: #000;
      }

      .signature-label {
        color: #000;
      }

      .section, .signature-section {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>
  <div class="contract-container">
    <div class="title">Contrato de Préstamo - Financiera Caribe Azul</div>

    <div class="section">
      <h3 class="section-heading">Información del Cliente</h3>
      <table class="data-table">
        <tbody>
          <tr><th>Nombre Completo</th><td><%= prestamo.cliente_nombre %> <%= prestamo.cliente_apellidos %></td></tr>
          <tr><th>Cédula</th><td><%= prestamo.cliente_cedula %></td></tr>
          <tr><th>Profesión</th><td><%= prestamo.cliente_profesion || 'No especificada' %></td></tr>
          <tr><th>Teléfono</th><td><%= prestamo.cliente_telefono1 %></td></tr>
          <tr><th>Dirección</th><td><%= prestamo.cliente_direccion %></td></tr>
          <tr><th>Ruta</th><td><%= prestamo.ruta_nombre || 'No asignada' %></td></tr>
          <tr><th>Zona</th><td><%= prestamo.ruta_zona || 'No especificada' %></td></tr>
        </tbody>
      </table>
    </div>

    <div class="section">
      <h3 class="section-heading">Datos del Préstamo</h3>
      <table class="data-table">
        <tbody>
          <tr><th>Número de Préstamo</th><td><%= prestamo.id %></td></tr>
          <tr><th>Fecha de Creación</th><td><%= moment(prestamo.created_at).format('DD/MM/YYYY') %></td></tr>
          <tr><th>Monto Aprobado</th><td>RD$ <%= Number(prestamo.monto_aprobado).toLocaleString('es-DO', {minimumFractionDigits:2}) %></td></tr>
          <% if (prestamo.interes_manual && prestamo.interes_manual > 0) { %>
            <tr>
              <th>Interés Fijo (<%= prestamo.frecuencia_interes === 'quincenal' ? 'Quincenal' : 'Mensual' %>)</th>
              <td>RD$ <%= Number(prestamo.interes_manual).toLocaleString('es-DO', {minimumFractionDigits:2}) %></td>
            </tr>
          <% } else { %>
            <tr><th>Tasa de Interés</th><td><%= prestamo.interes_porcentaje %>%</td></tr>
          <% } %>
          <tr><th>Frecuencia de Interés</th><td><%= prestamo.frecuencia_interes === 'quincenal' ? 'Quincenal' : 'Mensual' %></td></tr>
          <tr><th>Plazo</th><td><%= prestamo.plazo_meses %> meses</td></tr>
          <tr><th>Forma de Pago</th><td><%= prestamo.forma_pago %></td></tr>
          <tr><th>Estado</th><td><%= prestamo.estado %></td></tr>
        </tbody>
      </table>
    </div>

    <div class="section">
      <h3 class="section-heading">Términos y Condiciones</h3>
      <p class="commitment-text">
        <strong>1. Obligación de Pago:</strong> Yo, <strong><%= prestamo.cliente_nombre %> <%= prestamo.cliente_apellidos %></strong>, con cédula número <%= prestamo.cliente_cedula %>, me comprometo formalmente a pagar el préstamo aprobado bajo las condiciones acordadas.
        
        <br><br>
        <strong>2. Intereses y Mora:</strong> En caso de incumplimiento, reconozco un recargo por mora del <strong>2% diario</strong> sobre el saldo capital pendiente, a partir del segundo día de atraso después del período de pago establecido (<%= prestamo.frecuencia_interes === 'quincenal' ? '15 días' : '30 días' %>).
        
        <br><br>
        <strong>3. Garantías:</strong> Asimismo, reconozco que de persistir la falta de pago, me comprometo a responder con cualquier bien de mi propiedad (muebles, inmuebles, vehículos u otros) como garantía para saldar la deuda, autorizando expresamente a Financiera Caribe Azul a iniciar las acciones legales y/o judiciales correspondientes para recuperar el monto adeudado.
        
        <br><br>
        <strong>4. Aceptación de Términos:</strong> Este contrato representa el acuerdo completo entre las partes y sustituye cualquier acuerdo o entendimiento previo. Cualquier modificación a este contrato debe realizarse por escrito y ser firmada por ambas partes.
      </p>
    </div>

    <div class="signature-section">
      <div class="signature-block">
        <div class="signature-line"></div>
        <p class="signature-label">Firma del Cliente</p>
        <p class="signature-label">Fecha: <%= moment().format('DD/MM/YYYY') %></p>
      </div>
      <div class="signature-block">
        <div class="signature-line"></div>
        <p class="signature-label">Firma del Representante</p>
        <p class="signature-label">Financiera Caribe Azul</p>
        <p class="signature-label">Fecha: <%= moment().format('DD/MM/YYYY') %></p>
      </div>
    </div>
  </div>

  <script>
    window.onload = () => window.print();
    window.onafterprint = () => window.close();
  </script>
</body>
</html>